[pytest]
addopts = -p no:warnings --nomigrations
DJANGO_SETTINGS_MODULE = django_cas.settings.local

[tox]
envlist=py36
platform = linux2|darwin
skipsdist=true

[testenv:py36]
setenv =
    ASYNC_TEST_TIMEOUT = 60
    PYTHONUNBUFFERED=x
deps = -rrequirements/local.txt
commands=
    pytest --cov=django_cas {posargs}
    modcov --fail-under=85 --git --exclude=tests/*,deploy/*,*/migrations/*,docs/*

[testenv:lint]
basepython = python3.6
deps = -rrequirements/local.txt

commands =
    pre-commit clean
    pre-commit run -v

; [testenv:deploy]
; passenv=
;     SSH_AUTH_SOCK
;     PWD
; basepython = python3.6
; deps =
;     -rrequirements/production.txt
;     ansible==2.6.0
; commands =
;     ./manage.py migrate
;     ansible-galaxy install -r deploy/ansible/requirements.yml
;     ansible-playbook deploy/ansible/dev-playbook.yml
